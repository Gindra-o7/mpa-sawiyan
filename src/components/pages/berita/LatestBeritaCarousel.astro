---
import { ArrowLeft, ArrowRight } from "lucide-astro";

interface BeritaItem {
  slug: string;
  category: string;
  judul: string;
  thumbnail: string;
  excerpt: string;
  date_created: string;
  author: string;
}

const { latestBerita } = Astro.props;
---

<section class="mb-10 py-4">
  <!-- Header -->
  <div class="flex items-center justify-between mb-8">
    <h2 class="text-3xl md:text-4xl font-bold text-gray-900">Berita Terbaru</h2>

    <!-- Navigation Buttons -->
    <div class="flex items-center gap-2">
      <button
        class="embla__prev-latest flex items-center justify-center w-10 h-10 bg-white border border-gray-200 rounded-lg text-gray-700 hover:bg-brand-primary hover:text-white hover:border-brand-primary transition-all duration-300 disabled:opacity-30 disabled:cursor-not-allowed"
      >
        <ArrowLeft class="w-5 h-5" />
      </button>
      <button
        class="embla__next-latest flex items-center justify-center w-10 h-10 bg-white border border-gray-200 rounded-lg text-gray-700 hover:bg-brand-primary hover:text-white hover:border-brand-primary transition-all duration-300 disabled:opacity-30 disabled:cursor-not-allowed"
      >
        <ArrowRight class="w-5 h-5" />
      </button>
    </div>
  </div>

  <!-- Carousel Container -->
  <div class="embla-carousel-latest relative overflow-visible py-2">
    <div class="embla__viewport-latest overflow-hidden cursor-grab active:cursor-grabbing">
      <div class="embla__container-latest flex gap-6">
        {
          latestBerita.map((berita: BeritaItem) => (
            <div class="embla__slide-latest flex-shrink-0 basis-full md:basis-1/2 lg:basis-1/3 min-w-0 z-10">
              <article class="group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2 overflow-hidden h-full relative">
                {/* Image */}
                <a href={`/berita/${berita.slug}`} class="block relative h-56 overflow-hidden">
                  <img src={berita.thumbnail} alt={berita.judul} class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" loading="lazy" />
                  <div class="absolute inset-0 bg-gradient-to-t from-brand-primary/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
                </a>

                {/* Content */}
                <div class="p-6">
                  {/* Category */}
                  <div class="mb-3">
                    <span class="inline-block px-3 py-1 bg-brand-secondary/10 text-brand-primary text-xs font-bold rounded-full uppercase">{berita.category}</span>
                  </div>

                  {/* Title */}
                  <h3 class="text-xl font-bold text-gray-900 mb-3 group-hover:text-brand-primary transition-colors duration-200 line-clamp-2">
                    <a href={`/berita/${berita.slug}`}>{berita.judul}</a>
                  </h3>

                  {/* Metadata */}
                  <div class="text-sm text-gray-500">
                    {berita.author}{" "}
                    {new Intl.DateTimeFormat("id-ID", {
                      month: "short",
                      day: "numeric",
                      year: "numeric",
                    }).format(new Date(berita.date_created))}
                  </div>
                </div>
              </article>
            </div>
          ))
        }
      </div>
    </div>
  </div>
</section>

<script>
  import EmblaCarousel from "embla-carousel";

  const emblaRoot = document.querySelector(".embla-carousel-latest");

  if (emblaRoot) {
    const viewport = emblaRoot.querySelector<HTMLElement>(".embla__viewport-latest");
    const prevBtn = emblaRoot.querySelector<HTMLButtonElement>(".embla__prev-latest");
    const nextBtn = emblaRoot.querySelector<HTMLButtonElement>(".embla__next-latest");

    if (viewport && prevBtn && nextBtn) {
      const emblaApi = EmblaCarousel(viewport, {
        loop: false,
        align: "start",
        dragFree: true,
        slidesToScroll: 1,
      });

      const updateArrowButtons = () => {
        if (!emblaApi) return;
        const canScrollPrev = emblaApi.canScrollPrev();
        const canScrollNext = emblaApi.canScrollNext();

        prevBtn.disabled = !canScrollPrev;
        nextBtn.disabled = !canScrollNext;

        if (canScrollPrev) {
          prevBtn.classList.remove("opacity-30", "cursor-not-allowed");
        } else {
          prevBtn.classList.add("opacity-30", "cursor-not-allowed");
        }

        if (canScrollNext) {
          nextBtn.classList.remove("opacity-30", "cursor-not-allowed");
        } else {
          nextBtn.classList.add("opacity-30", "cursor-not-allowed");
        }
      };

      prevBtn.addEventListener(
        "click",
        () => {
          if (emblaApi.canScrollPrev()) {
            emblaApi.scrollPrev();
          }
        },
        false,
      );

      nextBtn.addEventListener(
        "click",
        () => {
          if (emblaApi.canScrollNext()) {
            emblaApi.scrollNext();
          }
        },
        false,
      );

      emblaApi.on("select", updateArrowButtons);
      emblaApi.on("reInit", updateArrowButtons);
      emblaApi.on("resize", updateArrowButtons);

      updateArrowButtons();
    }
  }
</script>
