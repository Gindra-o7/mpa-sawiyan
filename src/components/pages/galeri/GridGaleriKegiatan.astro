---
interface GaleriKegiatan {
  id: string;
  title: string;
  category: string;
  mainImage: string;
  thumbnails: string[];
  totalPhotos: number;
  date: string;
  images: string[];
}

const { kegiatan } = Astro.props;
---

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6" data-gallery-container>
  {kegiatan.map((item: GaleriKegiatan) => (
    <div
      class="group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2 overflow-hidden cursor-pointer"
      data-gallery-category={item.category}
      data-gallery-id={item.id}
    >
      {/* Main Image */}
      <div class="relative h-64 overflow-hidden">
        <img
          src={item.mainImage}
          alt={item.title}
          class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
          loading="lazy"
        />
        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
      </div>

      {/* Thumbnails Row */}
      {item.thumbnails.length > 0 && (
        <div class="flex gap-2 p-2 bg-gray-50">
          {item.thumbnails.slice(0, 2).map((thumb, idx) => (
            <div key={idx} class="flex-1 h-20 rounded-lg overflow-hidden">
              <img
                src={thumb}
                alt=""
                class="w-full h-full object-cover"
                loading="lazy"
              />
            </div>
          ))}
        </div>
      )}

      {/* Content */}
      <div class="p-4">
        <h3 class="font-bold text-gray-900 mb-2 group-hover:text-[#388E3C] transition-colors duration-200 line-clamp-2">
          {item.title}
        </h3>
        <div class="flex items-center justify-between">
          <span class="text-sm text-gray-500">{item.totalPhotos} Foto</span>
          <span class="text-xs text-gray-400">{item.date}</span>
        </div>
      </div>
    </div>
  ))}
</div>

<script is:inline>
  // Handle gallery item click to open modal
  // Use event delegation for better reliability
  (function() {
    const initGalleryClickHandlers = () => {
      // Use event delegation on the container
      const container = document.querySelector("[data-gallery-container]");
      if (container) {
        container.addEventListener("click", (e) => {
          const target = e.target;
          const card = target.closest("[data-gallery-id]");
          if (card) {
            const galleryId = card.getAttribute("data-gallery-id");
            if (galleryId) {
              // Try both methods: global function and custom event
              if (typeof window.openGalleryModal === "function") {
                window.openGalleryModal(galleryId);
              } else {
                // Fallback to custom event
                const event = new CustomEvent("openGalleryModal", { 
                  detail: { id: galleryId },
                  bubbles: true,
                  cancelable: true
                });
                document.dispatchEvent(event);
              }
            }
          }
        });
      }
    };

    // Initialize when DOM is ready
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", () => {
        // Add small delay to ensure modal script is ready
        setTimeout(initGalleryClickHandlers, 200);
      });
    } else {
      // DOM already loaded
      setTimeout(initGalleryClickHandlers, 200);
    }
  })();
</script>

